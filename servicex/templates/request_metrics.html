{% set base_url = "https://atlas-kibana.mwt2.org:5601/s/servicex/app/visualize?auth_provider_hint=anonymous1#" %}

{% macro request_metrics(req) %}
  <iframe
    style="border: 0; min-height: 300px; min-width: 400px"
    src="{{ base_url }}/edit/0edd85f0-b744-11eb-89e4-591876ef80c0?embed=true&_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-15d,to:now))&_a=(filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'36dec330-ad11-11eb-8b3b-c396407b1355',key:requestID,negate:!f,params:(query:{{ req.request_id }}),type:phrase),query:(match_phrase:(requestID:{{ req.request_id }})))),linked:!t,query:(language:kuery,query:''),uiState:(),vis:(aggs:!((enabled:!t,id:'1',params:(customLabel:'wall%20time',field:wall-time),schema:metric,type:sum),(enabled:!t,id:'5',params:(customLabel:Request,field:requestID,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderAgg:(enabled:!t,id:'5-orderAgg',params:(field:wall-time),schema:orderAgg,type:sum),orderBy:custom,otherBucket:!t,otherBucketLabel:Other,size:5),schema:split,type:terms),(enabled:!t,id:'3',params:(customLabel:'user%20time',field:user-time),schema:metric,type:sum),(enabled:!t,id:'4',params:(customLabel:'system%20time',field:system-time),schema:metric,type:sum)),params:(addLegend:!t,addTimeMarker:!f,addTooltip:!t,categoryAxes:!((id:CategoryAxis-1,labels:(filter:!f,rotate:0,show:!f,truncate:200),position:left,scale:(type:linear),show:!f,style:(),title:(),type:category)),grid:(categoryLines:!t,valueAxis:ValueAxis-1),labels:(),legendPosition:right,row:!t,seriesParams:!((data:(id:'1',label:'wall%20time'),drawLinesBetweenPoints:!t,lineWidth:2,mode:normal,show:!t,showCircles:!t,type:histogram,valueAxis:ValueAxis-1),(data:(id:'3',label:'user%20time'),drawLinesBetweenPoints:!t,lineWidth:2,mode:normal,show:!t,showCircles:!t,type:histogram,valueAxis:ValueAxis-1),(data:(id:'4',label:'system%20time'),drawLinesBetweenPoints:!t,lineWidth:2,mode:normal,show:!t,showCircles:!t,type:histogram,valueAxis:ValueAxis-1)),thresholdLine:(color:%23E7664C,show:!f,style:full,value:10,width:1),times:!(),type:histogram,valueAxes:!((id:ValueAxis-1,labels:(filter:!t,rotate:75,show:!t,truncate:100),name:LeftAxis-1,position:bottom,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'wall%20time'),type:value))),type:horizontal_bar))">
  </iframe>

  <iframe
    style="border: 0; min-height: 300px; min-width: 400px"
    src="{{ base_url }}/edit/5d0222d0-ad1d-11eb-8b3b-c396407b1355?embed=true&_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:'{{ req.submit_time_iso }}',to:'{{ req.finish_time_iso }}'))&_a=(filters:!(('$state':(store:appState),meta:(alias:!n,disabled:!f,index:'36dec330-ad11-11eb-8b3b-c396407b1355',key:requestID,negate:!f,params:(query:{{ req.request_id }}),type:phrase),query:(match_phrase:(requestID:{{ req.request_id }})))),linked:!t,query:(language:kuery,query:''),uiState:(),vis:(aggs:!((enabled:!t,id:'1',params:(customLabel:'Request%20ID',field:kubernetes.pod.name),schema:metric,type:cardinality),(enabled:!t,id:'2',params:(drop_partials:!f,extended_bounds:(),field:'@timestamp',interval:auto,min_doc_count:1,scaleMetricValues:!f,timeRange:(from:now-12d,to:now),useNormalizedEsInterval:!t),schema:segment,type:date_histogram),(enabled:!t,id:'3',params:(field:requestID,missingBucket:!f,missingBucketLabel:Missing,order:desc,orderBy:'1',otherBucket:!f,otherBucketLabel:Other,size:50),schema:group,type:terms)),params:(addLegend:!t,addTimeMarker:!f,addTooltip:!t,categoryAxes:!((id:CategoryAxis-1,labels:(filter:!t,show:!t,truncate:100),position:bottom,scale:(type:linear),show:!t,style:(),title:(),type:category)),grid:(categoryLines:!f),labels:(show:!f),legendPosition:right,seriesParams:!((data:(id:'1',label:'Request%20ID'),drawLinesBetweenPoints:!t,lineWidth:2,mode:stacked,show:!t,showCircles:!t,type:histogram,valueAxis:ValueAxis-1)),thresholdLine:(color:%23E7664C,show:!f,style:full,value:10,width:1),times:!(),type:histogram,valueAxes:!((id:ValueAxis-1,labels:(filter:!f,rotate:0,show:!t,truncate:100),name:LeftAxis-1,position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:'Request%20ID'),type:value))),title:'active%20transformers%20in%20time',type:histogram))">
  </iframe>
{% endmacro %}